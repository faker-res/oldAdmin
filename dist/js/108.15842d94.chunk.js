webpackJsonp([108],{1428:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,a=o(n(144)),s=o(n(332)),r=o(n(333));function o(e){return e&&e.__esModule?e:{default:e}}t.default={data:function(){return{CreatRoleForm:{name:"",title:"",description:"",permissionId:[]},PermissionsList:[],permissionCount:{},CreatRoleFormRules:{name:[{required:!0,pattern:/^.*$/,message:"请输入角色标识！",trigger:"blur"}],title:[{required:!0,pattern:/^.*$/,message:"请输入角色名称",trigger:"blur"}]}}},watch:{PermissionsList:{handler:function(e,t){e&&(this.CreatRoleForm.permissionId=this.createPermissionId())},deep:!0}},mounted:function(){var e=this;this.$nextTick(function(){e.$route.query&&e.$route.query.id&&e.$route.query.isVerify?e.getRolePermissionsList(!0).then(function(){e.isVerifyFn()}):e.getRolePermissionsList(!1)})},methods:{watchChildChangeFun:function(e,t){var n=0;e.children.forEach(function(e){e.checked&&n++,e.children.forEach(function(e){e.checked&&n++})}),0<n&&n==this.permissionCount[t]?(this.$set(e,"checkAll",!0),this.$set(e,"indeterminate",!1)):0<n&&n<this.permissionCount[t]?(this.$set(e,"checkAll",!1),this.$set(e,"indeterminate",!0)):(this.$set(e,"checkAll",!1),this.$set(e,"indeterminate",!1))},checkChildFun:function(e,t,n,i){var a=this.PermissionsList[t],s=a.children[n],r=(s.children[i],0);s.children.forEach(function(e){e.checked&&r++}),0<r&&r==s.children.length?(this.$set(s,"indeterminate",!1),this.$set(s,"checked",!0),this.$set(s,"sendParentId",!0)):0<r&&r<s.children.length?(this.$set(s,"indeterminate",!0),this.$set(s,"checked",!1),this.$set(s,"sendParentId",!0)):(this.$set(s,"indeterminate",!1),this.$set(s,"checked",!1),this.$set(s,"sendParentId",!1)),this.watchChildChangeFun(a,e)},checkParentFun:function(e,t,n){var i=this,a=this.PermissionsList[t],s=a.children[n],r=!!s.checked;this.$set(a,"indeterminate",r),this.$set(s,"indeterminate",!1),this.$set(s,"sendParentId",r),s.children.length&&s.children.forEach(function(e){i.$set(e,"checked",r)}),this.watchChildChangeFun(a,e)},checkGrandPaFun:function(e){var t=this,n=this.PermissionsList[e],i=!!n.checkAll;this.$set(n,"indeterminate",!1),n.children.forEach(function(e){t.$set(e,"checked",i),t.$set(e,"sendParentId",i),t.$set(e,"indeterminate",!1),e.children.length&&e.children.forEach(function(e){t.$set(e,"checked",i)})})},checkAllPermission:function(t){var n=this;this.PermissionsList.forEach(function(e){n.$set(e,"checkAll",t),n.$set(e,"indeterminate",!1),e.children.forEach(function(e){n.$set(e,"checked",t),n.$set(e,"sendParentId",t),n.$set(e,"indeterminate",!1),e.children.length&&e.children.forEach(function(e){n.$set(e,"checked",t)})})})},createPermissionId:function(){var t=[];return this.PermissionsList.forEach(function(e){e.children.forEach(function(e){e.sendParentId&&t.push(e.permission_id),e.children.length&&e.children.forEach(function(e){e.checked&&t.push(e.permission_id)})})}),t},getRolePermissionsList:(i=(0,r.default)(s.default.mark(function e(n){var i=this;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$root.HTTP_ALLLINKGET(this.$root.HTTP_L.HTTP_GetRolePermissionsList).then(function(e){i.PermissionsList=e.data.data,i.PermissionsList.forEach(function(e){n||i.$set(e,"checkAll",!1),n||i.$set(e,"indeterminate",!1);var t=0;e.children.forEach(function(e){n||i.$set(e,"checked",!1),n||i.$set(e,"indeterminate",!1),n||i.$set(e,"sendParentId",!1),t++,e.children.length&&e.children.forEach(function(e){n||i.$set(e,"checked",!1),t++})}),i.permissionCount[e.name]=t})});case 2:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)}),isVerifyFn:function(){var a=this;this.$root.HTTP_ALLLINKGET(this.$root.HTTP_L.HTTP_GetRoleDetails,{id:this.$route.query.id}).then(function(t){a.CreatRoleForm.id=t.data.data.id,a.CreatRoleForm.name=t.data.data.name,a.CreatRoleForm.title=t.data.data.title,a.CreatRoleForm.description=t.data.data.description,a.PermissionsList.forEach(function(e){var i=0;e.children.forEach(function(e){var n=0;t.data.data.permissions.forEach(function(t){e.permission_id==t.id&&(i++,a.$set(e,"checked",!0),a.$set(e,"sendParentId",!0)),e.children.length&&e.children.forEach(function(e){e.permission_id==t.id&&(i++,n++,a.$set(e,"checked",!0))})}),e.children.length&&(0<n&&n==e.children.length?(a.$set(e,"checked",!0),a.$set(e,"sendParentId",!0),a.$set(e,"indeterminate",!1)):0<n&&n<e.children.length?(a.$set(e,"checked",!1),a.$set(e,"sendParentId",!0),a.$set(e,"indeterminate",!0)):(a.$set(e,"checked",!1),a.$set(e,"sendParentId",!1),a.$set(e,"indeterminate",!1)))}),0<i&&i==a.permissionCount[e.name]?(a.$set(e,"checkAll",!0),a.$set(e,"indeterminate",!1)):0<i&&i<a.permissionCount[e.name]?(a.$set(e,"checkAll",!1),a.$set(e,"indeterminate",!0)):(a.$set(e,"checkAll",!1),a.$set(e,"indeterminate",!1))})})},CreatRole:function(){var n=this;this.$refs.CreatRoleForm.validate(function(e){if(e){n.$root.loading();var t=(0,a.default)({},n.CreatRoleForm);n.$route.query.isVerify?(delete t.name,n.$root.HTTP_ALLLINKPOST(n.$root.HTTP_L.HTTP_UpdateRole,t).then(function(e){n.$Spin.hide(),n.$Modal.success({title:"提示",content:"角色修改成功！"})}).catch(function(e){n.$Spin.hide()})):(delete t.id,n.$root.HTTP_ALLLINKPOST(n.$root.HTTP_L.HTTP_CreateRole,t).then(function(e){n.$refs.CreatRoleForm.resetFields(),n.$Spin.hide(),n.$Modal.success({title:"提示",content:"角色添加成功！"}),n.$router.push({name:"RolePermissionsList"})}).catch(function(e){n.$Spin.hide()}))}})}}}},1738:function(e,t,n){var i=n(1739);"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);n(75)("ec66bbf6",i,!1,{})},1739:function(e,t,n){(e.exports=n(74)(!1)).push([e.i,"\n.check-all-checkbox[data-v-3e59746b] {\n  margin-top: 10px;\n}\n.checkbox-wrapper[data-v-3e59746b] {\n  width: 95%;\n}\n.checkbox-wrapper .title[data-v-3e59746b] {\n  padding: 0 15px;\n  font-weight: bold;\n}\n.checkbox-wrapper .content[data-v-3e59746b] {\n  padding: 10px 15px 0;\n}\n.checkbox-wrapper .content .sub[data-v-3e59746b] {\n  padding: 0 30px 10px;\n}\n.checkbox-wrapper .content .sub[data-v-3e59746b] .ivu-checkbox-wrapper {\n  width: 19%;\n}\n.checkbox-wrapper .index .content[data-v-3e59746b] {\n  display: inline-block;\n  width: 19%;\n}\n.checkbox-wrapper .parent-Panel[data-v-3e59746b] .ivu-collapse > .ivu-collapse-item > .ivu-collapse-header {\n  height: 30px;\n  line-height: 30px;\n}\n.checkbox-wrapper .parent-Panel[data-v-3e59746b] .ivu-collapse-content > .ivu-collapse-content-box {\n  padding-top: 10px;\n  padding-bottom: 0;\n}\n.checkbox-wrapper .tip[data-v-3e59746b] {\n  padding-left: 30px;\n  font-size: 12px;\n}\n.checkbox-wrapper .tool[data-v-3e59746b] {\n  float: right;\n  font-size: 12px;\n  padding-right: 20px;\n}\n",""])},1740:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){var r=this,e=r.$createElement,o=r._self._c||e;return o("div",{staticClass:"user_info"},[o("div",{staticClass:"layout"},[o("div",{staticClass:"page-header"},[o("h1",{staticClass:"binding"},[r._v(r._s(r.$route.meta.title))])]),r._v(" "),o("div",{staticClass:"page-con1"},[o("Form",{ref:"CreatRoleForm",attrs:{model:r.CreatRoleForm,rules:r.CreatRoleFormRules,"label-width":210}},[o("FormItem",{attrs:{label:"角色标识",prop:"name"}},[o("i-input",{staticStyle:{width:"260px"},attrs:{disabled:!!r.$route.query.isVerify,placeholder:"支持数字、字母、中划线、下划线"},model:{value:r.CreatRoleForm.name,callback:function(e){r.$set(r.CreatRoleForm,"name",e)},expression:"CreatRoleForm.name"}})],1),r._v(" "),o("FormItem",{attrs:{label:"角色名称",prop:"title"}},[o("i-input",{staticStyle:{width:"260px"},attrs:{placeholder:"请输入角色名称"},model:{value:r.CreatRoleForm.title,callback:function(e){r.$set(r.CreatRoleForm,"title",e)},expression:"CreatRoleForm.title"}})],1),r._v(" "),o("FormItem",{attrs:{label:"角色描述",prop:"description"}},[o("i-input",{staticStyle:{width:"260px"},attrs:{type:"textarea",rows:4,maxlength:50,placeholder:"请输入角色描述"},model:{value:r.CreatRoleForm.description,callback:function(e){r.$set(r.CreatRoleForm,"description",e)},expression:"CreatRoleForm.description"}})],1),r._v(" "),o("FormItem",{attrs:{label:"权限设置",prop:"permissionId"}},[o("div",{staticClass:"checkbox-wrapper"},r._l(r.PermissionsList,function(a,s){return o("div",{key:s,staticClass:"grandPa-Panel"},[o("Collapse",{attrs:{value:a.checkAll?a.name:a.indeterminate?a.name:""}},[o("Panel",{attrs:{name:a.name}},[o("Checkbox",{staticClass:"title",attrs:{indeterminate:a.indeterminate},on:{"on-change":function(e){r.checkGrandPaFun(s)}},model:{value:a.checkAll,callback:function(e){r.$set(a,"checkAll",e)},expression:"grandPa.checkAll"}},[r._v(r._s(a.name))]),r._v(" "),o("div",{staticClass:"tool"},[o("span",[r._v("展开/关闭")]),r._v(" "),o("Icon",{attrs:{type:"ios-arrow-down",size:14}})],1),r._v(" "),o("div",{attrs:{slot:"content"},slot:"content"},[o("div",{staticClass:"parent-Panel",class:{index:"首页"==a.name}},r._l(a.children,function(t,i){return a.children.length?o("div",{key:i,staticClass:"content"},["首页"==a.name?o("Checkbox",{attrs:{indeterminate:t.indeterminate},on:{"on-change":function(e){r.checkParentFun(a.name,s,i)}},model:{value:t.checked,callback:function(e){r.$set(t,"checked",e)},expression:"parent.checked"}},[o("span",{attrs:{"data-url":t.permission?t.permission.name:"#","data-type":t.type||"#"}},[r._v(r._s(t.name))])]):r._e(),r._v(" "),"首页"!=a.name?o("Collapse",{attrs:{value:t.checked?t.name:t.indeterminate?t.name:""}},[o("Panel",{attrs:{name:t.name}},[o("Checkbox",{staticClass:"title",attrs:{indeterminate:t.indeterminate},on:{"on-change":function(e){r.checkParentFun(a.name,s,i)}},model:{value:t.checked,callback:function(e){r.$set(t,"checked",e)},expression:"parent.checked"}},[o("span",{attrs:{"data-url":t.permission?t.permission.name:"#","data-type":t.type||"#"}},[r._v(r._s(t.name))])]),r._v(" "),o("div",{staticClass:"tool"},[o("span",[r._v("展开/关闭")]),r._v(" "),o("Icon",{attrs:{type:"ios-arrow-down",size:14}})],1),r._v(" "),t.children.length?o("div",{staticClass:"sub",attrs:{slot:"content"},slot:"content"},r._l(t.children,function(t,n){return o("Checkbox",{key:n,on:{"on-change":function(e){r.checkChildFun(a.name,s,i,n)}},model:{value:t.checked,callback:function(e){r.$set(t,"checked",e)},expression:"child.checked"}},[o("span",{attrs:{"data-url":t.permission?t.permission.name:"#","data-type":t.type||"#"}},[r._v(r._s(t.name))])])}),1):o("div",{staticClass:"tip",attrs:{slot:"content"},slot:"content"},[r._v("没有下级权限")])],1)],1):r._e()],1):r._e()}),0)])],1)],1)],1)}),0),r._v(" "),o("div",{staticClass:"check-all-checkbox"},[o("Checkbox",{on:{"on-change":r.checkAllPermission}},[r._v("勾选所有权限")])],1)]),r._v(" "),o("FormItem",[o("Button",{attrs:{loading:r.$root.btnLoading,type:"primary"},on:{click:r.CreatRole}},[r.$route.query.isVerify?o("span",[r._v("确定修改")]):o("span",[r._v("确定创建")])]),r._v(" "),o("Button",{on:{click:r.$root.go_back}},[r._v("返回")])],1)],1)],1)])])};i._withStripped=!0;var a={render:i,staticRenderFns:[]};t.default=a},743:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1428),a=n.n(i);for(var s in i)"default"!==s&&function(e){n.d(t,e,function(){return i[e]})}(s);var r=n(1740),o=n.n(r),c=!1;var l=function(e){c||n(1738)},d=n(63)(a.a,o.a,!1,l,"data-v-3e59746b",null);d.options.__file="src/template/CommonPage/RoleCreate.vue",t.default=d.exports}});